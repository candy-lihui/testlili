# 1.web

- web 1.0 强调用户读功能 公司门户网站,政府官网
- web 2.0 强调用户参与度,电商,论坛
- web 3.0 互联网+,智能家居

# 2.jmeter

## 2.1jmeter可以做什么

1.接口测试

2.压力测试

3.性能测试

4.数据库测试

5.java程序测试

## 2.2jmeter环境搭建

- 需要java环境----jmeter是100%纯java语言编写的桌面应用程序
- jmeter下载安装
  - https://jmeter.apache.org/ 下载解压,jmeter存放路径最好不要有中文

## 2.3jmeter启动

- 在jmeter文件夹里面---->bin文件夹--->在windows环境下:双击jmeter.bat文件
- Linux环境下:启动jmeter.sh文件

## 2.4jmeter插件

1. 插件下载地址： <http://jmeter-plugins.org/downloads/all/>

2. 插件下载后解压：找到JMeterPlugins-Extras.jar,把JMeterPlugins-Extras.jar放到apache-jmeter-2.12\lib\ext目录。并重启jmeter。插件位置，在jmeter界面菜单栏——选项

## 2.5jmeter常用文件

1. **bin目录**

examples:　　　　　　　  目录中有CSV样例

**jmeter.bat 　　　　 windows的启动文件**

jmeter.log 　　　 jmeter运行日志文件

jmeter.sh 　　　　　linux的启动文件

**jmeter.properties 　　　   系统配置文件**

**jmeter-server.bat     windows分布式测试要用到的服务器配置**

jmeters-server    linux分布式测试要用的服务器配置

注：其中系统配置文件中的SSL设置重点关注如下几个：

\# 指定HTTPS协议层

https.default.protocol=TLS

\# 指定SSL版本
https.default.protocol=SSLv3

\# 设置启动的协议
https.socket.protocols=SSLv2Hello SSLv3 TLSv1

\# 缓存控制，控制SSL是否可以在多个迭代中重用
https.use.cached.ssl.context=true

**2.Printable_docs目录**

- Printable_docs ---->usermanual:用户手册

- usermanual--->**component_reference.html:**核心元件帮助文档

## 3.jmeter发送http请求步骤

- 1.打开jmeter
- 2.添加测试计划(jmeter默认)
- 3.添加线程组
- 4.选择取样器--->http请求
- 5.填写http请求内容
- 6.监听器中--->查看结果树
- 7.保存并启动

## 4.jmeter元件

### 4.1测试计划

- 一个jmeter脚本只有一个测试计划
- 测试计划可以编辑项目名称

### 4.2线程组

- 一个线程数表示一个用户(虚拟用户)
- 线程组名称基本命名以功能来做的
- Ramp-Up时间:表示在N秒内启动所有线程
  - 例如:当线程数=10,Ramp-Up=5,表示在5秒内启动10个线程数
- 循环次数:执行线程组的次数
- 延迟启动:(s)

### 4.3取样器

- 功能
  - 向服务器发送请求,并记录相应时间,记录响应数据
- http请求
  - 接口测试
- JDBC请求
  - 数据库测试
- 添加取样器---->只能在线程组添加

### 4.4逻辑控制器

- 控制取样器执行顺序(执行逻辑
  - 条件判断/循环等
- 性能测试相关吞吐量控制器
- 添加逻辑控制器,只能在线程组中添加

吞吐量:在1秒内可以处理的事务

### 4.5配置元件

- 功能
  - 参数化
  - 初始化参数 可用在http请求中的
- 添加配置元件
  - 测试计划添加
  - 线程组添加
  - 逻辑控制器中添加
  - 取样器中添加

### 4.6定时器(类似time.sleep)

控制操作之间的延迟即用于操作之间设置等待时间

### 4.7前置处理器

- 在取样器执行之前执行
- 功能
  - 准备测试数据

### 4.8后置处理器

- 在取样器执行之后执行
- 功能
  - 获取返回值

### 4.9断言

- 验证测试结果

### 4.10监听器

- 展示测试结果

## 5.jmeter测试计划要素

- 一个jmeter脚本中测试计划只能有一个
- 测试计划中至少有一个线程组
- 线程组中至少有一个取样器
- 测试计划中至少有一个监听器

# jmeter核心知识点

## 1.发送http请求

- http请求
  - 线程组---取样器---http请求
- http请求内容填写
  - 名称:写接口名称----接口文档
  - 注释:选填
  - 基本:
    - web服务器
      - 协议:	 必填  http
      - 域名/IP:     必填
      - 端口号: 如果有,必填,否则就不填
    - http请求
      - 请求方式: 根据被测接口的请求方式选择
      - 路径:  接口地址----除了域名和端口之外的部分
      - 编码: utf-8
      - 参数: 接口的请求参数,非raw类型(json)
      - 消息体数据:比如说json格式数据

注意事项:

- 当请求接口的参数类型不是jmeter默认的text/plan时,需要添加http消息头管理

## 2.http属性管理器

- http信息头管理器
  - 线程组---配置元件----http信息头管理
  - 管理http协议中requests的headers
  - 在http信息头中添加请求头
    - Centent-Type-->类型
- http请求默认值
  - 线程组--->配置元件--->http默认值
  - 功能:
    - 将请求地址中的协议名称,域名/IP,端口号提前设定
    - 后续的http请求可以不用填写web服务器部分
  - 当http请求(取样器)不填写域名/端口的时候默认使用http请求默认值的地址
  - 当http请求(取样器)填写域名/IP,使用自己填写的
  - 作用范围:
    - 当在线程组下添加,作用范围就是本线程组所有的http请求取样器
    - 当在测试计划下添加,作用范围就是测试计划中所有的http请求取样器
- http授权管理器
  - 针对需要授权操作的接口
    - 高权限的用户可以操作低权限用户的功能
  - 填写内容
    - 基础url
      - http://域名/IP+端口号
    - 用户名
      - 有接口访问权限的用户名
    - 密码
      - 用户名对应的密码

## 3.jmeter参数化

### 3.1什么是参数化

- 根据需求动态获取数据并进行赋值的过程

### 3.2jmeter中使用变量方式

- 引用变量的方式: 	${变量名}

### 3.3jmeter参数化的方式

- **CSV Data Set Config:CSV数据文件设置**
  - 位置:
    - 配置元件----CSV数据文件设置
  - 步骤:
    - 测试计划中添加CSV数据文件设置
      - 线程组--->配置元件中--->CSV数据文件设置
    - 准备测试数据
      - CSV格式的文件
    - 对CSV数据文件设置做配置
      - 导入CSV格式的文件
      - 编码---选择utf-8
      - 添加变量名称
        - 如果有多个,使用英文逗号隔开
        - 变量名称可以直接自定义,也可以放置在csv文件首行
      - 忽略首行
        - 选择True或False,要看是否需要csv文件的第一行的数据
      - 分隔符
        - 如果csv文件使用的是逗号隔开的参数,那么分隔符就选择英文逗号
        - 如果csv文件使用的是制表符隔开的参数,那么分隔符就选择\t
  - CSV参数化方式适用范围
    - 数据量比较大的测试
- **User Variables:用户参数**
  - 适用于参数取值范围很小的时候
  - 位置:前置处理中--->用户参数
  - 配置
    - 添加变量
      - 添加变量名
    - 添加用户名
      - 添加变量名对应的值
  - 注意事项
    - 添加了多少用户,线程组就要填写对应的线程数量
      - 例如,添加了2个用户,线程组的线程数量就为2
    - 用户参数中的变量和接口的请求参数没有直接关系
- **用户定义变量**
  - 位置:
    - 测试计划页面
    - 配置元件---->用户定义变量
  - 配置
    - 变量名---变量值
  - 适用范围
    - 用于保存测试常量:测试地址,数据库地址,用户名,密码

## 4.jmeter关联

### 4.1json提取器

- 适用范围

  - 当接口返回类型为json格式的时候

- 所在位置

  - 后置处理器--->json提取器

- 配置json提取器

  ![1565080331563](C:\Users\Candy\AppData\Local\Temp\1565080331563.png)

json提取表达式

- $.. 从返回值根进行查找
- $..dep_id 需要获取的关键字对应的值
- Macth No.(for Random):0表示随机,1表示获取到的第一个值,-1表示所有获取的值
- 设置的默认值

### 4.2.xpath提取器

- 使用范围:当接口的返回值为xml格式或html格式
- 适用方式:
  - xpath表达式
  - 后置处理器--xpath提取器
- xpath配置
  - 引用名称
    - 设置变量名
  - XPath query:
    - xpath表达式
  - Macth No.(for Random):0表示随机,1表示获取到的第一个值,-1表示所有获取的值
  - 设置的默认值
  - 注意事项:
    - 勾选Use....
    - 勾选Quiet

### 4.3.正则表达式提取器

- 适用范围:

  - 适用于所有类型的返回值

- 配置:

  - 引用名称:变量名

  - 正则表达式:"session":{(.*?)}

  - ```
    #将要提取的内容用(.*?)
    ```

  - 模板（Template）：模板，用来从匹配的结果中创建一个字符串，这是通过正则表达式匹配出来的一组值，语法为：$1$指代第一组，$2$指代第二组，$0$指代整个匹配结果 

## 5.jmeter连接数据库

### 1.操作步骤

- 创建测试计划
  - 在测试计划页面添加数据库驱动
- 添加线程组
  - 添加jdbc连接组件 配置元件---JDBC connection configuration
  - 配置JDBC connection configuration
    - 填写建立连接的数据库名---ecshop
    - 填写数据库地址:
      - jdbc:mysql://数据库地址:端口号/ecshop(数据库名)?参数名=参数值&参数名1=参数值1
    - 选择数据库驱动选择的驱动要和连接的数据库类型一致
    - 数据库访问用户名
    - 数据库访问密码
  - 添加JDBC Request 取样器--JDBC Request
  - 配置JDBC Request
    - 访问数据名称要和连接数据库名称保持一致
    - 选择sql类型
    - 编写sql语句
  - 添加查看结果树

## 6.jmeter断言

- 定义:断言就是让程序代替人工去判断程序响应数据是否达到预期结果

### 6.1响应断言

- 作用
  - 用来断言响应文本--返回值内容
  - 用来断言响应代码--状态码
- 位置:通常情况是放置在需要断言的取样器下(http请求)

### 6.2大小断言

- 对接口返回值所占容量大小断言,断言单位(bytes)

### 6.3时间断言

-  断言接口从请求到返回数据所消耗的时间
- 当断言的时间小于实际消耗的时间,断言失败
- 当断言时间大于等于实际消耗的时间,断言成功

## 7.集合点

- 定时器->Synchronizing Timer
  - 每次集合的用户数
    - 最好可以被线程组中的线程数整除
  - 集合用户数设置的最大等待时间
    - 可以设置为0,表示无限等待,必须等到集合的线程数==设置集合的线程数
    - 当设置的等待时间不为0时,时间最好大于线程组中的启动时间,保证每次的集合数==设置的集合数

## 8.函数

- 使用步骤
  - 点击函数助手
  - 选择需要的函数
  - 填写必填项
  - 点击函数助手页面--生成
  - 复制生成函数
  - 粘贴到需要使用的位置
- counter计数器
- random函数
- time函数
- 线程组关联
  - setproperty函数
  - property函数
  - 操作步骤
    - 在测试计划中添加2个线程组
    - 在每个线程组中至少添加一个取样器(http请求)
    - 将第一个线程组http请求的返回值,使用后置处理器进行获取
    - 使用setproperty函数提升变量的作用域---提升到整个测试计划
      - 重命名提升作用域后的参数名称
      - 通过后置处理器提取的数据${变量名}
    - 在第一个线程组中添加一个beanshell 取样器,将setproperty函数复制在beanshell中
    - 在第二个线程组中http请求中使用提升作用域后的参数
    - 通过property函数来使用
      - 将提升作用域后的参数名填入

## 9.分布式

- 操作步骤
  - 执行机设置
    - jmeter配置文件
    - remote_hosts=执行机本地ip:1099
    - 打开执行机jmeter-sever
  - 控制机设置
    - 设置jmeter配置文件
    - remote_hosts=执行机本地ip:1099,有多个使用逗号隔开
    - 如果控制机不执行脚本,不用打开jmeter-sever,只需要打开jmeter
- 注意事项:
  - 1.控制机和执行机安装的jmeter版本一致
  - 2.控制机和执行机脚本存放路径一致(包括参数化的csv文件)
  - 3.需要关闭执行机和控制机防火墙
  - 4.保证执行机和控制机在同一网段下

## 10.逻辑控制器

作用范围:只对逻辑控制器内的取样器(http请求)起作用

### 10.1 if控制器

- 执行条件
  - 当判断条件为真的时候,执行本控制器中的取样器(http请求)
- 将条件解释为变量表达式
  - jexl3函数
  - groovy函数
  - 在上边2个函数中写条件表达式
- 评估所有请求的执行结果
  - ${JMeterThread.last_sample_ok}
    - 用来判断取样器执行结果,如果结果为真(取样器执行成功),继续执行剩余的取样器,如果执行结果为假(失败),剩余的取样器不再执行

### 10.2 for each控制器

- 前提条件
  - 一般和和用户定义变量一起使用
- 用户定义变量配置
  - 变量名:前缀_后缀(后缀为数字)
- for each控制器配置
  - 输入变量前缀----指用户定义变量中的变量名的前缀
  - 开始循环的字段(不包含)
  - 结束循环的字段(包含)
  - 输出的变量名:指的是最终取样器使用的变量名称
- 注意事项:
  - 循环字段有几个,取样器就执行几次
  - 用户定义变量名的后缀,决定for each控制器中起始循环字段的填写

### 10.3循环控制器

- 控制控制器内的取样器的执行次数
- 可以灵活控制取样器的执行
- application

# 元件执行顺序

- config elements ---配置元件
- pre-processors---前置处理器
- timer------定时器
- sampler-----取样器
- post-porcessors----后置处理器
- assirtions-----断言
- Listener------监听器

